<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    <script src="common.js"></script>
</head>
<body>
    <script type="text/javascript">
        (function () {
            // angular
            var appName = 'streaming-knife';

            angular.module(appName, []);

            angular.module(appName).service('dispatcher', Common.Dispatcher);

            var TextArea = function (dispatcher) {
                var vm = this;
                vm.title = 'HELLO!';

                var writing = function () {
                    dispatcher.dispatch(new Common.Payload('writing', vm.data));
                };

                vm.writing = writing;
            };

            var Logger = function ($log, dispatcher) {
                var id = dispatcher.register(function (payload) {
                    $log.info('payload: ' + JSON.stringify(payload));
                });

                $log.info('id: ' + id);
            }

            angular.module(appName).controller('TextArea', TextArea);

            angular.module(appName).controller('Logger', Logger);
        })();
    </script>


    <div ng-app="streaming-knife">
        <div ng-controller="TextArea as vm">
            <h1>{{vm.title}}</h1>
            <textarea rows="5" cols="25" ng-model="vm.data" ng-change="vm.writing()"></textarea>
        </div>

        <div ng-controller="Logger"></div>
    </div>
</body>
</html>
